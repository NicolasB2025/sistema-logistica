<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Sistema Log√≠stico ‚Äì Fechamento Di√°rio</title>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #f2f2f2;
  color: #333;
  margin: 30px;
}

header {
  text-align: center;
  margin-bottom: 25px;
}

header img {
  max-height: 90px;
  margin-bottom: 10px;
}

h2 {
  margin-bottom: 5px;
}

.box {
  background: #ffffff;
  border-radius: 8px;
  padding: 20px;
  max-width: 900px;
  margin: 0 auto 20px auto;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}

label {
  display: block;
  margin-top: 10px;
  font-weight: bold;
}

input, select {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  margin-top: 14px;
  padding: 10px;
  width: 100%;
  background: #5b5bd6;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button.secondary {
  background: #888;
}

button.danger {
  background: #c0392b;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

th {
  background: #eaeaea;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<header>
  <!-- üî¥ LOGOTIPO DA EMPRESA -->
  <img src="logo.png" alt="Logo da Empresa">
  <h2>Sistema Log√≠stico ‚Äì Fechamento Di√°rio</h2>
  <p>Cadastro ‚Ä¢ Entregas ‚Ä¢ Relat√≥rio Excel</p>
</header>

<!-- ================= ETAPA 1 ================= -->
<div class="box" id="etapa1">
<h3>Configura√ß√£o do Dia</h3>

<label>Cliente</label>
<input id="cliente">

<label>Per√≠odo</label>
<input id="periodo">

<label>Localiza√ß√£o</label>
<input id="local">

<label>Di√°ria Motoboy (R$)</label>
<input id="dm">

<label>Di√°ria Coordena√ß√£o (R$)</label>
<input id="dcoord">

<label>Taxa M√≠nima Motoboy (R$)</label>
<input id="tm">

<label>KM Limite Motoboy</label>
<input id="kmm">

<label>Valor KM Extra Motoboy (R$)</label>
<input id="vkm">

<label>Di√°ria Cliente (R$)</label>
<input id="dc">

<label>Taxa M√≠nima Cliente (R$)</label>
<input id="tc">

<label>KM Limite Cliente</label>
<input id="kmc">

<label>Valor KM Extra Cliente (R$)</label>
<input id="vkc">

<label>Taxa de Chuva ‚Äì Motoboy (R$)</label>
<input id="chuva_moto">

<label>Taxa de Chuva ‚Äì Cliente (R$)</label>
<input id="chuva_cliente">

<label>Custo Operacional (R$)</label>
<input id="custo">

<button onclick="irEtapa2()">CONTINUAR</button>
</div>

<!-- ================= ETAPA 2 ================= -->
<div class="box hidden" id="etapa2">
<h3>Cadastro de Motoboys</h3>

<label>Nome</label>
<input id="nome_moto" onkeydown="if(event.key==='Enter') addMotoboy()">

<label>Tipo</label>
<select id="tipo_moto">
  <option value="">Selecione</option>
  <option>Fixo</option>
  <option>Freelancer</option>
  <option>Coordena√ß√£o</option>
</select>

<label>Vale (R$)</label>
<input id="vale_moto">

<label>
  <input type="checkbox" id="aplica_chuva">
  Aplica taxa de chuva
</label>

<button onclick="addMotoboy()">Adicionar Motoboy</button>
<button class="danger" onclick="removerMotoboy()">Apagar Motoboy Selecionado</button>

<table>
<thead>
<tr>
  <th>Nome</th>
  <th>Tipo</th>
  <th>Chuva?</th>
</tr>
</thead>
<tbody id="lista_motoboys"></tbody>
</table>

<button class="secondary" onclick="voltar1()">‚¨Ö Voltar</button>
<button onclick="irEtapa3()">IR PARA ENTREGAS</button>
</div>

<!-- ================= ETAPA 3 ================= -->
<div class="box hidden" id="etapa3">
<h3>Entregas</h3>

<label>Entregador</label>
<select id="entregador"></select>

<label>KM da entrega</label>
<input id="km_entrega" onkeydown="if(event.key==='Enter') addEntrega()">

<button onclick="addEntrega()">Adicionar Entrega</button>
<button class="danger" onclick="removerEntrega()">Apagar Entrega Selecionada</button>

<table>
<thead>
<tr>
  <th>Motoboy</th>
  <th>KM</th>
</tr>
</thead>
<tbody id="lista_entregas"></tbody>
</table>

<button class="secondary" onclick="voltar2()">‚¨Ö Voltar</button>
<button onclick="gerarExcel()">GERAR EXCEL</button>
</div>

<script>
let dados = {};
let motoboys = [];
let entregas = [];
let selMoto = -1;
let selEnt = -1;

/* --- JS IGUAL AO QUE VOC√ä J√Å USA --- */
/* Nenhuma l√≥gica alterada */

function irEtapa2() {
  dados = {
    cliente: cliente.value,
    periodo: periodo.value,
    local: local.value,
    dm: +dm.value,
    dcoord: +dcoord.value,
    tm: +tm.value,
    kmm: +kmm.value,
    vkm: +vkm.value,
    dc: +dc.value,
    tc: +tc.value,
    kmc: +kmc.value,
    vkc: +vkc.value,
    chuva_moto: +chuva_moto.value,
    chuva_cliente: +chuva_cliente.value,
    custo: +custo.value
  };
  etapa1.classList.add("hidden");
  etapa2.classList.remove("hidden");
}

function voltar1() {
  etapa2.classList.add("hidden");
  etapa1.classList.remove("hidden");
}

function voltar2() {
  etapa3.classList.add("hidden");
  etapa2.classList.remove("hidden");
}

function addMotoboy() {
  if (!nome_moto.value) return;
  motoboys.push({
    nome: nome_moto.value,
    tipo: tipo_moto.value,
    vale: +vale_moto.value || 0,
    aplica_chuva: aplica_chuva.checked
  });
  nome_moto.value = "";
  vale_moto.value = "";
  aplica_chuva.checked = false;
  nome_moto.focus();
  renderMotoboys();
}

function removerMotoboy() {
  if (selMoto >= 0) {
    motoboys.splice(selMoto, 1);
    selMoto = -1;
    renderMotoboys();
  }
}

function renderMotoboys() {
  lista_motoboys.innerHTML = "";
  motoboys.forEach((m, i) => {
    lista_motoboys.innerHTML += `
      <tr onclick="selMoto=${i}">
        <td>${m.nome}</td>
        <td>${m.tipo}</td>
        <td>${m.aplica_chuva ? "Sim" : "N√£o"}</td>
      </tr>`;
  });
}

function irEtapa3() {
  etapa2.classList.add("hidden");
  etapa3.classList.remove("hidden");
  entregador.innerHTML = "";
  motoboys.forEach((m, i) => {
    entregador.innerHTML += `<option value="${i}">${m.nome}</option>`;
  });
}

function addEntrega() {
  if (!km_entrega.value) return;
  entregas.push({
    id_moto: +entregador.value,
    km: +km_entrega.value
  });
  km_entrega.value = "";
  km_entrega.focus();
  renderEntregas();
}

function removerEntrega() {
  if (selEnt >= 0) {
    entregas.splice(selEnt, 1);
    selEnt = -1;
    renderEntregas();
  }
}

function renderEntregas() {
  lista_entregas.innerHTML = "";
  entregas.forEach((e, i) => {
    lista_entregas.innerHTML += `
      <tr onclick="selEnt=${i}">
        <td>${motoboys[e.id_moto].nome}</td>
        <td>${e.km}</td>
      </tr>`;
  });
}

function gerarExcel() {
  fetch("http://127.0.0.1:5000/gerar_excel", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ dados, motoboys, entregas })
  })
  .then(res => res.blob())
  .then(blob => {
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "relatorio_logistica.xlsx";
    a.click();
  });
}
</script>

</body>
</html>

